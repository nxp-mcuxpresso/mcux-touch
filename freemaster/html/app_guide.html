<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>NXP Touch Library Reference Manual: NXP Touch library integration.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nxp_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">NXP Touch Library Reference Manual
   &#160;<span id="projectnumber">Rev 2.0</span>
   </div>
   <div id="projectbrief">NXP Semiconductors, Inc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('app_guide.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">NXP Touch library integration. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section describes how to integrate the NXP Touch library into an existing application project. There are several ways of using the NXP Touch library. The simplest way is to use the prepared MCUXpresso SDK-based example projects or the NXP Touch library can be add to your existing application project.</p>
<h1><a class="anchor" id="app_guide_0"></a>
Creating Application with NXP Touch Library</h1>
<p>You can use the library in these two ways:</p>
<ul>
<li>Put the library source files directly into the application project <em>(as described below).</em></li>
<li>Compile the library files into a statically-linked library and use the library in your application project.</li>
</ul>
<p>This chapter presents the option where all library files are added to the user application project, and compiled together with the application. The other option is to use the prepared MCUXpresso SDK-based projects where all toolchains are supported (see: the MCUXpresso SDK/boards/<em>your_board</em>/demo_apps/touch_sensing). This chapter describes the NXP Touch library integration into the IAR Embedded Workbench IDE only. If you want to use another toolchain, see the <em>Getting Started with MCUXpresso SDK</em> device documentation, where the integration into all toolchains is explained using an example project. The application demonstrated in this section uses <a class="el" href="group__keypad.html">keypad</a> consists of two touch electrodes on the FRDM-KE15Z board, four touch electrodes, and the <a class="el" href="group__aslider.html">analog slider</a> and <a class="el" href="group__arotary.html">analog rotary</a> controls on the FRDM-TOUCH board. The following paragraphs explain how to create such projects.</p>
<h2><a class="anchor" id="app_guide_1"></a>
Adding Library Files into the Project</h2>
<p>The library can be easily integrated into your application by adding the NXP Touch source files into your project. See the <a class="el" href="directory.html">Directory Structure</a> section to understand the files and folders of the NXP Touch library. There are two steps to take:</p>
<ul>
<li>The "include" search paths of your project must be extended to cover the directories with public header files (the /middleware/touch/include folder).</li>
<li>The source code files must be added into the project (the MCUXpresso SDK/middleware/touch/source folder and all subfolders). Not all source files are always used in the application, but the linker should take care of optimizing the unused code out of the executable.</li>
</ul>
<p>The library uses the startup code, the linker files, and some low-level driver code from the MCUXpresso SDK or from the existing application project, (if used). This code is not considered to be a part of the NXP Touch library, but it serves as a base for example applications. You can also reuse the MCUXpresso SDK linker files and drivers in your own custom applications. However, it is better to get the latest MCUXpresso SDK version from the NXP website.</p>
<p>The figure below shows a typical NXP Touch application project in the IAR Embedded Workbench IDE:</p>
<div class="image">
<img src="include.png" alt="include.png"/>
<div class="caption">
Workspace directory</div></div>
<h2><a class="anchor" id="app_guide_2"></a>
Setting 'include' Search Paths</h2>
<p>The figure shows how to set up the search paths in IAR Embedded Workbench IDE. Only one include path is needed from the NXP Touch point of view. The pre-processor symbols should be defined to identify the CPU and Board for the MCUXpresso SDK low-level code. The valid options can be found in the fsl_device_registers.h file, located in the MCUXpresso SDK/devices/directory.</p>
<div class="image">
<img src="preprocesor_ke15.png" alt="preprocesor_ke15.png"/>
<div class="caption">
Include search path for KE15z</div></div>
<div class="image">
<img src="preprocesor_qn9080.png" alt="preprocesor_qn9080.png"/>
<div class="caption">
Include search path for QN908x</div></div>
<div class="image">
<img src="preprocesor_k32l2a4s.png" alt="preprocesor_k32l2a4s.png"/>
<div class="caption">
Include search path for K32L2A4S</div></div>
<p>All search paths: Only the last four paths are currently mandatory for the NXP Touch library, the others are required by MCUXpresso SDK. The path list for the KE15z based board with TSI v5. </p>
<div class="fragment"><div class="line">PROJ_DIR$/../../../../../CMSIS/Include</div>
<div class="line">$PROJ_DIR$/../../../../../devices</div>
<div class="line">$PROJ_DIR$/..</div>
<div class="line">$PROJ_DIR$/../../../../../devices/MKE15Z7/drivers</div>
<div class="line">$PROJ_DIR$/../../../../../devices/MKE15Z7</div>
<div class="line">$PROJ_DIR$/../../../../../devices/MKE15Z7/utilities/io</div>
<div class="line">$PROJ_DIR$/../../../../../devices/MKE15Z7/utilities/str</div>
<div class="line">$PROJ_DIR$/../../../../../devices/MKE15Z7/utilities/log</div>
<div class="line">$PROJ_DIR$/../../../../../devices/MKE15Z7/utilities</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/boards/frdmke15z</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/freemaster/driver/src_common</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/freemaster/driver/src_platforms/Kxx</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/include</div>
</div><!-- fragment --><p>The path list for the QN908x based board with CS module. </p>
<div class="fragment"><div class="line">PROJ_DIR$/../../../../../CMSIS/Include</div>
<div class="line">$PROJ_DIR$/../../../../../devices</div>
<div class="line">$PROJ_DIR$/..</div>
<div class="line">$PROJ_DIR$/../../../../../devices/QN908XC/drivers</div>
<div class="line">$PROJ_DIR$/../../../../../devices/QN908XC</div>
<div class="line">$PROJ_DIR$/../../../../../devices/QN908XC/utilities/io</div>
<div class="line">$PROJ_DIR$/../../../../../devices/QN908XC/utilities/str</div>
<div class="line">$PROJ_DIR$/../../../../../devices/QN908XC/utilities/log</div>
<div class="line">$PROJ_DIR$/../../../../../devices/QN908XC/utilities</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/boards/qn908xcdk</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/freemaster/driver/src_common</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/freemaster/driver/src_platforms/QN908x</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/include</div>
</div><!-- fragment --><p>TThe path list for the K32L2A based board with TSIv 4. </p>
<div class="fragment"><div class="line">$PROJ_DIR$/..</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/boards/frdmk32l2a4s</div>
<div class="line">$PROJ_DIR$/../../../../../CMSIS/Include</div>
<div class="line">$PROJ_DIR$/../../../../../devices</div>
<div class="line">$PROJ_DIR$/../middleware/touch/include</div>
<div class="line">$PROJ_DIR$/../../../../../devices/K32L2A41A/drivers</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/touch/include</div>
<div class="line">$PROJ_DIR$/../../../../../devices/K32L2A41A</div>
<div class="line">$PROJ_DIR$/../../../../../devices/K32L2A41A/utilities/str</div>
<div class="line">$PROJ_DIR$/../../../../../devices/K32L2A41A/utilities/debug_console</div>
<div class="line">$PROJ_DIR$/../../../../../components/uart</div>
<div class="line">$PROJ_DIR$/../../../../../components/serial_manager</div>
<div class="line">$PROJ_DIR$/../../../../../components/lists</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/freemaster/src/common</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/freemaster/src/drivers/mcuxsdk/serial</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/freemaster/src/drivers/mcuxsdk/can</div>
<div class="line">$PROJ_DIR$/../../../../../middleware/freemaster/src/platforms/gen32le</div>
<div class="line">$PROJ_DIR$/../../../../../devices/K32L2A41A/utilities</div>
</div><!-- fragment --><h2><a class="anchor" id="app_guide_3"></a>
Setting the 'linker' path</h2>
<p>The figure shows how to set up the linker file in IAR Embedded Workbench IDE. The linker file is reused from the MCUXpresso SDK. You may use your own linker file to have a full control over the linker process.</p>
<div class="image">
<img src="linker_ke15.png" alt="linker_ke15.png"/>
<div class="caption">
Linker command file path for KE15z</div></div>
<div class="image">
<img src="linker_qn9080.png" alt="linker_qn9080.png"/>
<div class="caption">
Linker command file path for QN908x</div></div>
<div class="image">
<img src="linker_k32l2a4s.png" alt="linker_k32l2a4s.png"/>
<div class="caption">
Linker command file path for K32L2A4S</div></div>
<h2><a class="anchor" id="app_guide_4"></a>
Application Setup</h2>
<p>To define the modules, electrodes, controls, and system, create the initialized instances of the structure types, as described in section <a class="el" href="nt_config.html">Configuring the Library</a>.</p>
<p>The code below shows an example configuration of two electrodes on the FRDM-KE15Z board, further four electrodes, analog rotary, and analog slider controls on the FRDM-TOUCH auxiliary board.</p>
<p>There are several <a class="el" href="examplespage.html#frdm_touch_app">key detectors</a> available in the NXP Touch library. The electrode structure types must always match the module and algorithm types.</p>
<p>This is an example of the uSAFA key detector configuration: </p>
<div class="fragment"><div class="line"><span class="comment">/* uSAFA keydetector settings */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__usafa.html#structnt__keydetector__usafa">nt_keydetector_usafa</a> keydec_usafa = </div>
<div class="line">{</div>
<div class="line"><span class="comment">/* Electrodes */</span></div>
<div class="line">    .<a class="code" href="group__usafa.html#ab58ef82b2b35d6b8d92ff6732195bbcb">signal_filter</a> = {2},</div>
<div class="line">    .base_avrg = {.n2_order = 12},</div>
<div class="line">    .non_activity_avrg =  {.n2_order = <a class="code" href="group__filter.html#ga62d43fb098bc60270ce1397c063d140e">NT_FILTER_MOVING_AVERAGE_MAX_ORDER</a>},</div>
<div class="line">    .entry_event_cnt = 4,</div>
<div class="line">    .signal_to_noise_ratio = 6,</div>
<div class="line">    .deadband_cnt = 4,</div>
<div class="line">    .min_noise_limit = 100,    </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__usafa.html#structnt__keydetector__usafa">nt_keydetector_usafa</a> keydec_usafa_slider = </div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__usafa.html#ab58ef82b2b35d6b8d92ff6732195bbcb">signal_filter</a> = {2},</div>
<div class="line">    .base_avrg = {.n2_order = 12},</div>
<div class="line">    .non_activity_avrg =  {.n2_order = <a class="code" href="group__filter.html#ga62d43fb098bc60270ce1397c063d140e">NT_FILTER_MOVING_AVERAGE_MAX_ORDER</a>},</div>
<div class="line">    .entry_event_cnt = 4,</div>
<div class="line">    .signal_to_noise_ratio = 3,</div>
<div class="line">    .deadband_cnt = 4,</div>
<div class="line">    .min_noise_limit = 50,    </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__usafa.html#structnt__keydetector__usafa">nt_keydetector_usafa</a> keydec_usafa_mutual = </div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__usafa.html#ab58ef82b2b35d6b8d92ff6732195bbcb">signal_filter</a> = {2},</div>
<div class="line">    .base_avrg = {.n2_order = 12},</div>
<div class="line">    .non_activity_avrg =  {.n2_order = <a class="code" href="group__filter.html#ga62d43fb098bc60270ce1397c063d140e">NT_FILTER_MOVING_AVERAGE_MAX_ORDER</a>},</div>
<div class="line">    .entry_event_cnt = 4,</div>
<div class="line">    .signal_to_noise_ratio = 3,</div>
<div class="line">    .deadband_cnt = 4,</div>
<div class="line">    .min_noise_limit = 50,    </div>
<div class="line">};</div>
</div><!-- fragment --><p>The electrode structure types must match the hardware module used for the data-measurement algorithm in the application. In this case, it is the <a class="el" href="group__electrodes.html#structnt__electrode">nt_electrode</a> type. Define the electrode parameters and the nt_keydetector interface.</p>
<div class="fragment"><div class="line"><span class="comment">/* Electrodes */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_0 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = BOARD_TSI_ELECTRODE_1,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa,</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_1 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = BOARD_TSI_ELECTRODE_2,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_2 =</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = NT_TSI_TRANSFORM_MUTUAL(FRDM_TOUCH_BOARD_TSI_MUTUAL_RX_ELECTRODE_1, FRDM_TOUCH_BOARD_TSI_MUTUAL_TX_ELECTRODE_1),</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_mutual,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_3 =</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = NT_TSI_TRANSFORM_MUTUAL(FRDM_TOUCH_BOARD_TSI_MUTUAL_RX_ELECTRODE_2, FRDM_TOUCH_BOARD_TSI_MUTUAL_TX_ELECTRODE_2),</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_mutual,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_4 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = NT_TSI_TRANSFORM_MUTUAL(FRDM_TOUCH_BOARD_TSI_MUTUAL_RX_ELECTRODE_3, FRDM_TOUCH_BOARD_TSI_MUTUAL_TX_ELECTRODE_3),</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_mutual,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_5 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = NT_TSI_TRANSFORM_MUTUAL(FRDM_TOUCH_BOARD_TSI_MUTUAL_RX_ELECTRODE_4, FRDM_TOUCH_BOARD_TSI_MUTUAL_TX_ELECTRODE_4),</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_mutual,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_6 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = FRDM_TOUCH_BOARD_TSI_SLIDER_ELECTRODE_1,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_slider,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_7 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = FRDM_TOUCH_BOARD_TSI_SLIDER_ELECTRODE_2,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_slider,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_8 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = FRDM_TOUCH_BOARD_TSI_ROTARY_ELECTRODE_1,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_slider,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_9 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = FRDM_TOUCH_BOARD_TSI_ROTARY_ELECTRODE_2,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_slider,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_10 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = FRDM_TOUCH_BOARD_TSI_ROTARY_ELECTRODE_3,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_slider,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> electrode_11 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__electrodes.html#a62f0105bfe4c3aca5d9eb662d8f61cdb">pin_input</a> = FRDM_TOUCH_BOARD_TSI_ROTARY_ELECTRODE_4,</div>
<div class="line">    .keydetector_interface = &amp;<a class="code" href="group__usafa.html#ga261726f91dc68813e4f1207f41fb5eb9">nt_keydetector_usafa_interface</a>,</div>
<div class="line">    .keydetector_params.usafa = &amp;keydec_usafa_slider,</div>
<div class="line">};</div>
</div><!-- fragment --><p>The Kinetis E family MCUs contain the TSI module version 5. The TSI hardware setup and configuraion for recalibration function are shown below.</p>
<div class="fragment"><div class="line"><span class="comment">/* Modules */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a> * <span class="keyword">const</span> module_0_electrodes[] = { \</div>
<div class="line">    &amp;electrode_0, &amp;electrode_1,                                      <span class="comment">/* FRDM-KE15Z electrodes */</span> \</div>
<div class="line">    &amp;electrode_2, &amp;electrode_3, &amp;electrode_4, &amp;electrode_5,          <span class="comment">/* FRDM-TOUCH electrodes */</span> \</div>
<div class="line">    &amp;electrode_6, &amp;electrode_7,                                      <span class="comment">/* analog slider elect. */</span>  \</div>
<div class="line">    &amp;electrode_8, &amp;electrode_9, &amp;electrode_10, &amp;electrode_11, <a class="code" href="group__types.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}; <span class="comment">/* analog rotary elect. */</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Self-cap and mutual-cap mode config */</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespace_3global_scope_4.html#structtsi__config__t">tsi_config_t</a> hw_config =</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Self capacitance measurement config */</span></div>
<div class="line">    .<a class="code" href="namespace_3global_scope_4.html#aa8778b375217ffc1b3e1b3c9c037efe8">configSelfCap</a>.commonConfig.mainClock = kTSI_MainClockSlection_0,         </div>
<div class="line">    .configSelfCap.commonConfig.mode = kTSI_SensingModeSlection_Self,         </div>
<div class="line">    .configSelfCap.commonConfig.dvolt = kTSI_DvoltOption_0,                   </div>
<div class="line">    .configSelfCap.commonConfig.cutoff = kTSI_SincCutoffDiv_0,                </div>
<div class="line">    .configSelfCap.commonConfig.order = kTSI_SincFilterOrder_2,               </div>
<div class="line">    .configSelfCap.commonConfig.decimation = kTSI_SincDecimationValue_4,      </div>
<div class="line">    .configSelfCap.commonConfig.chargeNum = kTSI_SscChargeNumValue_7,         </div>
<div class="line">    .configSelfCap.commonConfig.noChargeNum = kTSI_SscNoChargeNumValue_5,     </div>
<div class="line">    .configSelfCap.enableSensitivity = <span class="keyword">true</span>,                                  </div>
<div class="line">    .configSelfCap.xdn = kTSI_SensitivityXdnOption_3,                         </div>
<div class="line">    .configSelfCap.ctrim = kTSI_SensitivityCtrimOption_0,                     </div>
<div class="line">    .configSelfCap.inputCurrent = kTSI_CurrentMultipleInputValue_0,           </div>
<div class="line">    .configSelfCap.chargeCurrent = kTSI_CurrentMultipleChargeValue_0,         </div>
<div class="line">    <span class="comment">/* Mutual capacitance measurement config */</span></div>
<div class="line">    .configMutual.commonConfig.mainClock = kTSI_MainClockSlection_0,         </div>
<div class="line">    .configMutual.commonConfig.mode = kTSI_SensingModeSlection_Mutual,       </div>
<div class="line">    .configMutual.commonConfig.dvolt = kTSI_DvoltOption_3,                   </div>
<div class="line">    .configMutual.commonConfig.cutoff = kTSI_SincCutoffDiv_0,                </div>
<div class="line">    .configMutual.commonConfig.order = kTSI_SincFilterOrder_2,               </div>
<div class="line">    .configMutual.commonConfig.decimation = kTSI_SincDecimationValue_4,      </div>
<div class="line">    .configMutual.commonConfig.chargeNum = kTSI_SscChargeNumValue_4,         </div>
<div class="line">    .configMutual.commonConfig.noChargeNum = kTSI_SscNoChargeNumValue_2,     </div>
<div class="line">    .configMutual.preCurrent = kTSI_MutualPreCurrent_4uA,                    </div>
<div class="line">    .configMutual.preResistor = kTSI_MutualPreResistor_4k,                   </div>
<div class="line">    .configMutual.senseResistor = kTSI_MutualSenseResistor_10k,              </div>
<div class="line">    .configMutual.boostCurrent = kTSI_MutualSenseBoostCurrent_0uA,           </div>
<div class="line">    .configMutual.txDriveMode = kTSI_MutualTxDriveModeOption_0,              </div>
<div class="line">    .configMutual.pmosLeftCurrent = kTSI_MutualPmosCurrentMirrorLeft_32,     </div>
<div class="line">    .configMutual.pmosRightCurrent = kTSI_MutualPmosCurrentMirrorRight_1,    </div>
<div class="line">    .configMutual.enableNmosMirror = <span class="keyword">true</span>,                                   </div>
<div class="line">    .configMutual.nmosCurrent = kTSI_MutualNmosCurrentMirror_1,              </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>nt_tsi_recalib_config recalib_config = { </div>
<div class="line">    .SelfRangeMin     = 50000,     </div>
<div class="line">    .SelfRangeMax     = 60000,     </div>
<div class="line">    .SelfRangeDeltaMin= 400,       </div>
<div class="line">    .SelfRangeDeltaMax= 1300,      </div>
<div class="line">    .MutRangeMin      = 12000,     </div>
<div class="line">    .MutRangeMax      = 16000,     </div>
<div class="line">    .MutRangeDeltaMin = 300,       </div>
<div class="line">    .MutRangeDeltaMax = 600,       </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__gmodules.html#structnt__module">nt_module</a> tsi_module =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="group__gmodules.html#ae3e391185618ddc907553417898f3394">interface</a> = &amp;<a class="code" href="group__tsi.html#gabd64de61172c3caf0d3494180d469acf">nt_module_tsi_interface</a>,</div>
<div class="line">    .electrodes = &amp;module_0_electrodes[0],</div>
<div class="line">    .config = (<span class="keywordtype">void</span>*)&amp;hw_config,</div>
<div class="line">    .recalib_config = (<span class="keywordtype">void</span>*)&amp;<a class="code" href="group__gmodules.html#abda96bcde7a52b121aa7b9af748d1bee">recalib_config</a>,</div>
<div class="line">    .instance = 0,</div>
<div class="line">};</div>
</div><!-- fragment --><p>When the modules and electrodes are set up, you may define the <a class="el" href="group__controls.html">Controls</a>. In this case, the control_0 is the <a class="el" href="group__keypad.html">Keypad</a> control.</p>
<div class="fragment"><div class="line"><span class="comment">/* Keypad */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a>  * <span class="keyword">const</span> control_0_electrodes[] = { \</div>
<div class="line">    &amp;electrode_0, &amp;electrode_1,                                    <span class="comment">/* FRDM-KE15Z electrodes */</span>  \</div>
<div class="line">    &amp;electrode_2, &amp;electrode_3, &amp;electrode_4, &amp;electrode_5, <a class="code" href="group__types.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}; <span class="comment">/* FRDM-TOUCH electrodes */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__keypad.html#structnt__control__keypad">nt_control_keypad</a> keypad_params =</div>
<div class="line">{</div>
<div class="line">  .<a class="code" href="group__keypad.html#ac6f8221c52fda1dea87da00935a18fba">groups</a> = <a class="code" href="group__types.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line">  .groups_size = 0,</div>
<div class="line">  .multi_touch = (uint32_t[]){0x0C,0x18,0x30,0x24,0x3C},</div>
<div class="line">  .multi_touch_size = 5,  </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> keypad_0 =</div>
<div class="line">{</div>
<div class="line">  .<a class="code" href="group__gcontrols.html#aaecab192440047d60245233f72ef4169">interface</a> = &amp;<a class="code" href="group__keypad.html#gac485ba0e543a5d7bef7d95995c82f781">nt_control_keypad_interface</a>,</div>
<div class="line">  .electrodes = control_0_electrodes,</div>
<div class="line">  .control_params.keypad = &amp;keypad_params,</div>
<div class="line">};</div>
</div><!-- fragment --><p>The next control is the <a class="el" href="group__aslider.html">Analog Slider</a> control with the following setup.</p>
<div class="fragment"><div class="line"><span class="comment">/*Analog Slider*/</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a>  * <span class="keyword">const</span> control_1_electrodes[] = { \</div>
<div class="line">    &amp;electrode_6, &amp;electrode_7, <a class="code" href="group__types.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span><a class="code" href="group__aslider.html#structnt__control__aslider">nt_control_aslider</a> aslider_params = {</div>
<div class="line">    .<a class="code" href="group__aslider.html#afa09b12fdbe24cd1b70afd055d2ce54f">range</a> = 160,  </div>
<div class="line">    .insensitivity = 2, </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> aslider_0 =</div>
<div class="line">{</div>
<div class="line">  .<a class="code" href="group__gcontrols.html#aaecab192440047d60245233f72ef4169">interface</a> = &amp;<a class="code" href="group__aslider.html#ga44856c769cb27b70a939a98708b7a4bf">nt_control_aslider_interface</a>,</div>
<div class="line">  .electrodes = control_1_electrodes,</div>
<div class="line">  .control_params.aslider = &amp;aslider_params,</div>
<div class="line">};</div>
</div><!-- fragment --><p>The last control is the <a class="el" href="group__arotary.html">Analog Rotary</a> control with the following setup.</p>
<div class="fragment"><div class="line"><span class="comment">/*Analog Rotary*/</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__electrodes.html#structnt__electrode">nt_electrode</a>  * <span class="keyword">const</span> control_2_electrodes[] = { \</div>
<div class="line">    &amp;electrode_8, &amp;electrode_9, &amp;electrode_10, &amp;electrode_11, <a class="code" href="group__types.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span><a class="code" href="group__arotary.html#structnt__control__arotary">nt_control_arotary</a> arotary_params = {</div>
<div class="line">    .<a class="code" href="group__arotary.html#aeb2947fac107d563112fc142e5e8755f">range</a> = 72,  </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> arotary_0 =</div>
<div class="line">{</div>
<div class="line">  .<a class="code" href="group__gcontrols.html#aaecab192440047d60245233f72ef4169">interface</a> = &amp;<a class="code" href="group__arotary.html#ga671546927334b22a0bb2d7e7d55f556a">nt_control_arotary_interface</a>,</div>
<div class="line">  .electrodes = control_2_electrodes,</div>
<div class="line">  .control_params.arotary = &amp;arotary_params,</div>
<div class="line">};</div>
</div><!-- fragment --><p>Now you can connect all the pieces together in the <a class="el" href="group__system.html">system</a> structure.</p>
<div class="fragment"><div class="line"><span class="comment">/* System */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> * <span class="keyword">const</span> controls[] = {&amp;keypad_0, &amp;aslider_0, &amp;arotary_0, <a class="code" href="group__types.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__gmodules.html#structnt__module">nt_module</a> * <span class="keyword">const</span> modules[] = {&amp;tsi_module, <a class="code" href="group__types.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="group__system.html#structnt__system">nt_system</a> system_0 = {</div>
<div class="line">    .<a class="code" href="group__system.html#aff2e7129c8756d0993fcb511b8964432">controls</a> = &amp;controls[0],</div>
<div class="line">    .modules = &amp;modules[0],</div>
<div class="line">    .time_period = 5,</div>
<div class="line">    .init_time = 400,</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="app_guide_4b"></a>
The main() Function</h2>
<p>The application code is as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fsl_device_registers.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fsl_debug_console.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;fsl_ftm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fsl_lpit.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;main.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;board.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freemaster.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;fsl_lpuart.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pin_mux.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> TSI_DRV_IRQHandler(uint32_t instance);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> pit_init(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ftm_init(<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> init_freemaster_uart(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> keypad_callback(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> *control, </div>
<div class="line">                            <span class="keyword">enum</span> <a class="code" href="group__keypad.html#ga3951f40becb2d1b6fb8504d5a7e78d5f">nt_control_keypad_event</a> event,</div>
<div class="line">                            uint32_t index);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> aslider_callback(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> *control, </div>
<div class="line">                             <span class="keyword">enum</span> <a class="code" href="group__aslider.html#ga4d2acc2b15804fdb1afc947ab227ab28">nt_control_aslider_event</a> event,</div>
<div class="line">                             uint32_t position);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> arotary_callback(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> *control, </div>
<div class="line">                             <span class="keyword">enum</span> <a class="code" href="group__arotary.html#ga15787ceb2f237e9aabdce0c7daf46770">nt_control_arotary_event</a> event, </div>
<div class="line">                             uint32_t position);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Call when the TSI counter overflows 65535 */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> system_callback(uint32_t event);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> SetHueBrightness(uint32_t hue_angle, uint32_t brightness);</div>
<div class="line"></div>
<div class="line">uint8_t nt_memory_pool[5000];</div>
<div class="line"></div>
<div class="line">uint32_t brightness_global, hue_angle_global;</div>
<div class="line">uint8_t duty_cycle_red, duty_cycle_green, duty_cycle_blue;</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> ftm_config_t my_ftm_config = {    </div>
<div class="line">    .prescale = kFTM_Prescale_Divide_1,                 <span class="comment">/* Divide FTM clock by 1 */</span></div>
<div class="line">    .bdmMode = kFTM_BdmMode_0,                          <span class="comment">/* FTM behavior in BDM mode */</span></div>
<div class="line">    .pwmSyncMode = kFTM_SoftwareTrigger,                <span class="comment">/* Software trigger is used to update registers */</span></div>
<div class="line">    .reloadPoints = 0,                                  <span class="comment">/* No intermediate register load */</span></div>
<div class="line">    .faultMode = kFTM_Fault_Disable,                    <span class="comment">/* Fault control disabled for all channels */</span></div>
<div class="line">    .faultFilterValue = 0,                              <span class="comment">/* Disable the fault filter */</span></div>
<div class="line">    .deadTimePrescale = kFTM_Deadtime_Prescale_1,       <span class="comment">/* Divide the system clock by 1 */</span></div>
<div class="line">    .deadTimeValue = 0,                                 <span class="comment">/* No counts are inserted */</span></div>
<div class="line">    .extTriggers = 0,                                   <span class="comment">/* No external trigger */</span></div>
<div class="line">    .chnlInitState = 0,                                 <span class="comment">/* Initialization value is 0 for all channels */</span></div>
<div class="line">    .chnlPolarity = 0x00,                               <span class="comment">/* Active high polarity for all channels */</span></div>
<div class="line">    .useGlobalTimeBase = <span class="keyword">false</span>,                         <span class="comment">/* Use internal FTM counter as timebase */</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> ftm_chnl_pwm_signal_param_t my_ftm_channel_config[3] = {</div>
<div class="line">    {</div>
<div class="line">    .chnlNumber = kFTM_Chnl_0,   </div>
<div class="line">    .level = kFTM_LowTrue,       </div>
<div class="line">    .dutyCyclePercent = 0U,      </div>
<div class="line">    .firstEdgeDelayPercent = 0U, </div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">    .chnlNumber = kFTM_Chnl_1,   </div>
<div class="line">    .level = kFTM_LowTrue,       </div>
<div class="line">    .dutyCyclePercent = 0U,      </div>
<div class="line">    .firstEdgeDelayPercent = 0U, </div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">    .chnlNumber = kFTM_Chnl_2,   </div>
<div class="line">    .level = kFTM_LowTrue,       </div>
<div class="line">    .dutyCyclePercent = 0U,      </div>
<div class="line">    .firstEdgeDelayPercent = 0U, </div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> lpit_config_t my_pit_config = {</div>
<div class="line">    .enableRunInDebug = <span class="keyword">false</span>,     </div>
<div class="line">    .enableRunInDoze  = <span class="keyword">false</span>,     </div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This list describes all TSA tables that should be exported to the </span></div>
<div class="line"><span class="comment"> * FreeMASTER application.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#ifndef FMSTR_PE_USED</span></div>
<div class="line"><span class="preprocessor"></span>  FMSTR_TSA_TABLE_LIST_BEGIN()</div>
<div class="line">      FMSTR_TSA_TABLE(nt_frmstr_tsa_table)</div>
<div class="line">  FMSTR_TSA_TABLE_LIST_END()</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">      </div>
<div class="line"><span class="preprocessor">#define nt_printf(...) </span><span class="comment">/* do nothing - the debug lines are used by FreeMASTER */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>    </div>
<div class="line">    </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  int32_t result;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Init board hardware */</span></div>
<div class="line">  BOARD_InitPins();</div>
<div class="line">  </div>
<div class="line">  BOARD_BootClockRUN();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/*LED init*/</span></div>
<div class="line">  LED_RED1_INIT(1);</div>
<div class="line">  LED_GREEN1_INIT(1);</div>
<div class="line">  LED_BLUE_INIT(1);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Init FTM0 */</span></div>
<div class="line">  ftm_init();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Initialize the OS abstraction layer */</span></div>
<div class="line">  <a class="code" href="group__nt__osa.html#ga4fbf1b3a08201408f59e9e2e02e406aa">NT_OSA_Init</a>();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* FreeMASTER communicates over the default UART instance */</span></div>
<div class="line">  init_freemaster_uart();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* FreeMASTER initialization */</span></div>
<div class="line">  (void)FMSTR_Init();</div>
<div class="line">    </div>
<div class="line">  <span class="keywordflow">if</span> ((result = <a class="code" href="group__system__api.html#gae50df373022cdf199c235f19baff02ff">nt_init</a>(&amp;system_0, nt_memory_pool, <span class="keyword">sizeof</span>(nt_memory_pool))) != <a class="code" href="group__types.html#ggac5580df52121b80252be4eb5eaab2828a5122d5d816d4ae16c6372dddea3cb8f3">NT_SUCCESS</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">switch</span>(result)</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__types.html#ggac5580df52121b80252be4eb5eaab2828a72ac9b27f709d6569a643a4927df613e">NT_FAILURE</a>:</div>
<div class="line">      nt_printf(<span class="stringliteral">&quot;\nCannot initialize NXP Touch due to a non-specific error.\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__types.html#ggac5580df52121b80252be4eb5eaab2828a44497433be8510a7e093fa24da916460">NT_OUT_OF_MEMORY</a>:</div>
<div class="line">      nt_printf(<span class="stringliteral">&quot;\nCannot initialize NXP Touch due to a lack of free memory.\n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;\nCannot initialize NXP Touch due to a non-specific error.\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>; </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span>(1); <span class="comment">/* add code to handle this error */</span></div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">  nt_printf(<span class="stringliteral">&quot;\nNXP Touch is successfully initialized.\n&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  nt_printf(<span class="stringliteral">&quot;Unused memory: %d bytes, you can make the memory pool smaller without affecting the functionality.\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="group__system__api.html#gaced8bec095100c6144b25803e8310502">nt_mem_get_free_size</a>());</div>
<div class="line">  <span class="comment">/* Keypad electrodes*/</span></div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_0, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_1, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_2, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_3, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_4, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_5, 0);</div>
<div class="line">  <a class="code" href="group__gcontrols__api.html#gabf5c2e6d53db52f1cc86120037104372">nt_control_enable</a>(&amp;keypad_0);</div>
<div class="line">  <a class="code" href="group__keypad__api.html#ga576e3d641a0e65b56590b0520de32ef9">nt_control_keypad_set_autorepeat_rate</a>(&amp;keypad_0, 100, 1000);</div>
<div class="line">  <a class="code" href="group__keypad__api.html#gaaca95dda5da72919b578cfe101a9d0a4">nt_control_keypad_register_callback</a>(&amp;keypad_0, &amp;keypad_callback);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Slider electrodes */</span></div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_6, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_7, 0);</div>
<div class="line">  <a class="code" href="group__gcontrols__api.html#gabf5c2e6d53db52f1cc86120037104372">nt_control_enable</a>(&amp;aslider_0);</div>
<div class="line">  <a class="code" href="group__aslider__api.html#ga9caeec57ab5ff734b2daab9837457437">nt_control_aslider_register_callback</a>(&amp;aslider_0, &amp;aslider_callback);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Rotary electrodes */</span></div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_8, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_9, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_10, 0);</div>
<div class="line">  <a class="code" href="group__electrodes__api.html#ga713c8df50b094774920c606bc6c53109">nt_electrode_enable</a>(&amp;electrode_11, 0);</div>
<div class="line">  <a class="code" href="group__gcontrols__api.html#gabf5c2e6d53db52f1cc86120037104372">nt_control_enable</a>(&amp;arotary_0);</div>
<div class="line">  <a class="code" href="group__arotary__api.html#gaf83452e2dd888da8952b331933c4c58c">nt_control_arotary_register_callback</a>(&amp;arotary_0, &amp;arotary_callback);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* System TSI overflow warning callback */</span></div>
<div class="line">  <a class="code" href="group__system__api.html#gac9565141451d29530467ef4955d87071">nt_system_register_callback</a>(&amp;system_callback);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Auto TSI register recalibration function, not used as default */</span></div>
<div class="line">  <span class="keywordflow">if</span> (recalib_enabled) </div>
<div class="line">  { </div>
<div class="line">      recalib_status = (<a class="code" href="group__tsi__drivers.html#gae16b0cb31944dd3b945dd1493bc9a756">tsi_status_t</a>) <a class="code" href="group__gmodules__api.html#gadc53ee388ed66d22327ec324be403798">nt_module_recalibrate</a>(&amp;tsi_module, (<span class="keywordtype">void</span>*) &amp;recalib_config);</div>
<div class="line">  } </div>
<div class="line">  <span class="keywordflow">if</span> (one_key_only)</div>
<div class="line">  <a class="code" href="group__keypad__api.html#ga5d76858144f4e451e12ff89ad4c7b1d6">nt_control_keypad_only_one_key_valid</a>(&amp;keypad_0, <span class="keyword">true</span>);</div>
<div class="line">  </div>
<div class="line">  pit_init();</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span>(1)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__system__api.html#gab7f8ce7df0895777cc3b95837d651844">nt_task</a>();</div>
<div class="line">    </div>
<div class="line"></div>
<div class="line">    <span class="comment">/* The FreeMASTER poll call must be called in the main application loop</span></div>
<div class="line"><span class="comment">    to handle the communication interface and protocol. </span></div>
<div class="line"><span class="comment">       In the LONG_INTR FreeMASTER interrupt mode, all the processing is done </span></div>
<div class="line"><span class="comment">    during the communication interrupt routine and the FMSTR_Poll() is </span></div>
<div class="line"><span class="comment">    compiled empty. */</span></div>
<div class="line">    FMSTR_Poll();</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> LPIT0_IRQHandler(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Clear the interrupt flag.*/</span></div>
<div class="line">  LPIT_ClearStatusFlags(LPIT0, LPIT_MSR_TIF0_MASK);</div>
<div class="line">  <a class="code" href="group__system__api.html#ga79bb046f88b50bca26e3b20991fb1787">nt_trigger</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> TSI_IRQHandler(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  TSI_DRV_IRQHandler(0);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ftm_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* FTM0 Init */</span></div>
<div class="line">  FTM_Init(FTM0, &amp;my_ftm_config);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Configure FTM0 channels 0, 1, 2 */</span></div>
<div class="line">  FTM_SetupPwm(FTM0, my_ftm_channel_config, 3U, kFTM_EdgeAlignedPwm, 10000U, CLOCK_GetFreq(kCLOCK_CoreSysClk));</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Start timer */</span></div>
<div class="line">  FTM_StartTimer(FTM0, kFTM_SystemClock);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> pit_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Set the source for the LPIT module */</span></div>
<div class="line">  CLOCK_SetIpSrc(kCLOCK_Lpit0, kCLOCK_IpSrcSircAsync);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Init PIT */</span></div>
<div class="line">  LPIT_Init(LPIT0, &amp;my_pit_config);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Set PIT0 period 5ms */</span></div>
<div class="line">  LPIT_SetTimerPeriod(LPIT0, kLPIT_Chnl_0, 5*CLOCK_GetFreq(kCLOCK_ScgSircAsyncDiv2Clk)/1000);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Enable the PIT interrupt */</span></div>
<div class="line">  LPIT_EnableInterrupts(LPIT0, LPIT_MIER_TIE0_MASK);</div>
<div class="line">  EnableIRQ(LPIT0_IRQn);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Start the PIT timer */</span></div>
<div class="line">  LPIT_StartTimer(LPIT0, kLPIT_Chnl_0);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> keypad_callback(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> *control, </div>
<div class="line">                            <span class="keyword">enum</span> <a class="code" href="group__keypad.html#ga3951f40becb2d1b6fb8504d5a7e78d5f">nt_control_keypad_event</a> event,</div>
<div class="line">                            uint32_t index)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span>(event)</div>
<div class="line">  {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__keypad.html#gga3951f40becb2d1b6fb8504d5a7e78d5fae7e8ff8d7975a780f29b4d8c0a8a9ca4">NT_KEYPAD_RELEASE</a>:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (index) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 3:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 4:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 5:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__keypad.html#gga3951f40becb2d1b6fb8504d5a7e78d5fa9a3e643c114f3e9c2acfc7b06371ebd2">NT_KEYPAD_TOUCH</a>:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (index) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">              <span class="comment">/* YELLOW on, full brightness */</span></div>
<div class="line">              hue_angle_global = 12;</div>
<div class="line">              brightness_global = 120;</div>
<div class="line">              SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">              <span class="comment">/* CYAN on, full brightness */</span></div>
<div class="line">              hue_angle_global = 36;</div>
<div class="line">              brightness_global = 120;</div>
<div class="line">              SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">              <span class="comment">/* RED on, full brightness */</span></div>
<div class="line">              hue_angle_global = 0;</div>
<div class="line">              brightness_global = 120;</div>
<div class="line">              SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 3:</div>
<div class="line">              <span class="comment">/* GREEN on, full brightness */</span></div>
<div class="line">              hue_angle_global = 24;</div>
<div class="line">              brightness_global = 120;</div>
<div class="line">              SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 4:</div>
<div class="line">              <span class="comment">/* BLUE on, full brightness */</span></div>
<div class="line">              hue_angle_global = 48;</div>
<div class="line">              brightness_global = 120;</div>
<div class="line">              SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 5:</div>
<div class="line">              <span class="comment">/* WHITE on, full brightness */</span></div>
<div class="line">              hue_angle_global = 73;</div>
<div class="line">              brightness_global = 120;</div>
<div class="line">              SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__keypad.html#gga3951f40becb2d1b6fb8504d5a7e78d5fa2e833846a124c92b1c9090aed245311b">NT_KEYPAD_AUTOREPEAT</a>:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (index) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 3:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 4:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 5:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> aslider_callback(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> *control, </div>
<div class="line">                             <span class="keyword">enum</span> <a class="code" href="group__aslider.html#ga4d2acc2b15804fdb1afc947ab227ab28">nt_control_aslider_event</a> event,</div>
<div class="line">                             uint32_t position)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span>(event)</div>
<div class="line">  {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__aslider.html#gga4d2acc2b15804fdb1afc947ab227ab28a82e6cf4a4fb468f626fe101340cfd968">NT_ASLIDER_INITIAL_TOUCH</a>:</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__aslider.html#gga4d2acc2b15804fdb1afc947ab227ab28a648c5313b523bc808cf90d181e242831">NT_ASLIDER_MOVEMENT</a>:</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__aslider.html#gga4d2acc2b15804fdb1afc947ab227ab28abd89205267348c448919acc965d23402">NT_ASLIDER_ALL_RELEASE</a>:</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <span class="keywordflow">break</span>; </div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Recalculate and set RGB LED */</span></div>
<div class="line">  brightness_global = position;</div>
<div class="line">  SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> arotary_callback(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__gcontrols.html#structnt__control">nt_control</a> *control, </div>
<div class="line">                             <span class="keyword">enum</span> <a class="code" href="group__arotary.html#ga15787ceb2f237e9aabdce0c7daf46770">nt_control_arotary_event</a> event, </div>
<div class="line">                             uint32_t position)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (event) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__arotary.html#gga15787ceb2f237e9aabdce0c7daf46770ab6401fd3cc8e1cb91c07dc378901c560">NT_AROTARY_MOVEMENT</a>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__arotary.html#gga15787ceb2f237e9aabdce0c7daf46770a7565054ea7176e19210b74a2183d9a87">NT_AROTARY_ALL_RELEASE</a>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__arotary.html#gga15787ceb2f237e9aabdce0c7daf46770ae2c1ab62ee5a043c3c7746ecb50addff">NT_AROTARY_INITIAL_TOUCH</a>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Recalculate and set RGB LED */</span></div>
<div class="line">  hue_angle_global = position;  </div>
<div class="line">  SetHueBrightness(hue_angle_global, brightness_global);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Call on the TSI CNTR overflow 16-bit range (65535) */</span></div>
<div class="line"><span class="keywordtype">void</span> system_callback(uint32_t event)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span>(event)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__system.html#gga6c5a1f37d46f9fc7d1b317121a1ef44dad4087ae719e9473c7270aea3390f60c0">NT_SYSTEM_EVENT_DATA_OVERFLOW</a>:</div>
<div class="line">      <span class="comment">/* TSI counter overflow warning */</span></div>
<div class="line">      nt_printf(<span class="stringliteral">&quot;TSI CNTR overflow warning on electrode %d.\n&quot;</span>, (<span class="keywordtype">int</span>)index);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="keywordflow">break</span>;    </div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> SetHueBrightness(uint32_t hue_angle, uint32_t brightness)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Calculate Hue */</span></div>
<div class="line">  <span class="keywordflow">if</span>(hue_angle&lt;=24)</div>
<div class="line">  {</div>
<div class="line">    duty_cycle_red   = 24-hue_angle;</div>
<div class="line">    duty_cycle_green = hue_angle;</div>
<div class="line">    duty_cycle_blue  = 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>(hue_angle&gt;24 &amp;&amp; hue_angle&lt;=48)</div>
<div class="line">  {</div>
<div class="line">    duty_cycle_red   = 0;</div>
<div class="line">    duty_cycle_green = 48-hue_angle;</div>
<div class="line">    duty_cycle_blue  = hue_angle-24;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>(hue_angle&gt;48)</div>
<div class="line">  {</div>
<div class="line">    duty_cycle_red   = hue_angle-48;</div>
<div class="line">    duty_cycle_green = 0;</div>
<div class="line">    duty_cycle_blue  = 72-hue_angle;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* If hue_angle &gt; 72, set RGB to white */</span></div>
<div class="line">  <span class="keywordflow">if</span>(hue_angle &gt; 72)</div>
<div class="line">  {</div>
<div class="line">    duty_cycle_red   = 16;</div>
<div class="line">    duty_cycle_green = 16;</div>
<div class="line">    duty_cycle_blue  = 16;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Slider never returns position &lt; 60 */</span></div>
<div class="line">  brightness = brightness&lt;60 ? 0 : (brightness-60);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Set Hue multiplied by Brightness */</span>  </div>
<div class="line">  FTM0-&gt;CONTROLS[kFTM_Chnl_0].CnV = (duty_cycle_blue * (brightness));</div>
<div class="line">  FTM0-&gt;CONTROLS[kFTM_Chnl_1].CnV = (duty_cycle_green * (brightness));</div>
<div class="line">  FTM0-&gt;CONTROLS[kFTM_Chnl_2].CnV = (duty_cycle_red * (brightness));</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* Software trigger to update registers */</span></div>
<div class="line">  FTM_SetSoftwareTrigger(FTM0, <span class="keyword">true</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> init_freemaster_uart(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    lpuart_config_t lpuartConfig;</div>
<div class="line">    </div>
<div class="line">    CLOCK_SetIpSrc(kCLOCK_Lpuart1, BOARD_DEBUG_UART_CLKSRC);</div>
<div class="line">    uint32_t uartClkSrcFreq = CLOCK_GetIpFreq(kCLOCK_Lpuart1);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* UART configuration structure */</span></div>
<div class="line">    LPUART_GetDefaultConfig(&amp;lpuartConfig);</div>
<div class="line">    lpuartConfig.baudRate_Bps     = BOARD_DEBUG_UART_BAUDRATE;</div>
<div class="line">    lpuartConfig.enableTx         = <span class="keyword">true</span>;</div>
<div class="line">    lpuartConfig.enableRx         = <span class="keyword">true</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Init UART */</span></div>
<div class="line">    LPUART_Init((LPUART_Type *)BOARD_DEBUG_UART_BASEADDR, &amp;lpuartConfig, uartClkSrcFreq);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Enable UART interrupt */</span></div>
<div class="line">    EnableIRQ(LPUART1_IRQn);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* The base address is configured dynamically in this application, making the code slightly </span></div>
<div class="line"><span class="comment">       bigger/slower but more generic. See freemaster_cfg.h for more details */</span></div>
<div class="line">    <span class="comment">/*   The base address is offset by 0x10 due to some new regs in the KE15Z LPUART. */</span></div>
<div class="line">    FMSTR_SetSciBaseAddress((FMSTR_ADDR)(LPUART_Type *)(BOARD_DEBUG_UART_BASEADDR + 0x10));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">void</span> BOARD_UART_IRQ_HANDLER(<span class="keywordtype">void</span>)</div>
<div class="line"> {</div>
<div class="line">     FMSTR_Isr();</div>
<div class="line"> }</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Aug 2 2024 08:33:26 for NXP Touch Library Reference Manual by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
